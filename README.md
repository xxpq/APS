# Any Proxy Service - é«˜çº§ HTTP/HTTPS/gRPC ä»£ç†è½¬å‘å·¥å…·

## ç®€ä»‹

Any Proxy Service æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€é«˜åº¦å¯é…ç½®ã€å¯ç¼–å†™è„šæœ¬çš„å¤šåè®® API ç½‘å…³å’Œä»£ç†æœåŠ¡å™¨ã€‚å®ƒä¸“ä¸ºç°ä»£å¼€å‘ã€æµ‹è¯•å’Œç½‘ç»œè°ƒè¯•è€Œè®¾è®¡ï¼Œä¸ºæ‚¨æä¾›å¯¹ç½‘ç»œæµé‡æ— ä¸ä¼¦æ¯”çš„ç²¾ç»†åŒ–æ§åˆ¶èƒ½åŠ›ï¼Œå…è®¸æ‚¨æ£€æŸ¥ã€ä¿®æ”¹ã€é‡å®šå‘ã€è½¬æ¢å’Œæ¨¡æ‹Ÿå„ç§ç½‘ç»œæ¡ä»¶ã€‚

## âœ¨ åŠŸèƒ½çŸ©é˜µ

| ç±»åˆ«                 | åŠŸèƒ½ç‚¹                                                                                                                                                                                                                                                           |
| :------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **æ ¸å¿ƒä»£ç†**   | åŒæ—¶è¿è¡Œå¤šä¸ª HTTP/HTTPS ä»£ç†ã€è‡ªåŠ¨åŒ–çš„ HTTPS æµé‡æ‹¦æˆªã€ä¸Šæ¸¸ä»£ç†é“¾ã€‚                                                                                                                                                                                              |
| **é«˜çº§è·¯ç”±**   | åŸºäº URL (æ”¯æŒé€šé…ç¬¦ `*`ã€æ­£åˆ™è¡¨è¾¾å¼å’Œ `*://` åè®®é€šé…)ã€æ–¹æ³•ã€æ ‡å¤´ã€æŸ¥è¯¢å‚æ•°çš„çµæ´»æ˜ å°„è§„åˆ™ã€‚                                                                                                                                                                |
| **åè®®ç½‘å…³**   | gRPC ä»£ç†ã€WebSocket ä»£ç†ä¸åŒå‘æ¶ˆæ¯æ‹¦æˆªã€åŠ¨æ€ REST-to-gRPC è½¬æ¢ (æ— éœ€ä»£ç ç”Ÿæˆ)ã€‚                                                                                                                                                                                 |
| **æµé‡ç­–ç•¥**   | é€Ÿç‡é™åˆ¶ (e.g.,`500kbps`)ã€æµé‡é…é¢ (e.g., `10gb`)ã€è¯·æ±‚æ¬¡æ•°é…é¢ã€ç½‘ç»œè´¨é‡æ¨¡æ‹Ÿ (ä¸¢åŒ…ç‡)ã€‚                                                                                                                                                                    |
| **å®‰å…¨ä¸è®¤è¯** | åŸºäºç”¨æˆ·/ç»„çš„è®¿é—®æ§åˆ¶ï¼Œå¯åœ¨æœåŠ¡å™¨ã€è§„åˆ™ã€éš§é“ç­‰å¤šä¸ªçº§åˆ«åº”ç”¨ã€‚                                                                                                                                                                                                    |
| **è‡ªåŠ¨åŒ–**     | ä½¿ç”¨ Python/Node.js è„šæœ¬åœ¨è¯·æ±‚å’Œå“åº”é˜¶æ®µè¿›è¡ŒåŠ¨æ€ä¿®æ”¹ã€HAR æ—¥å¿—è®°å½•ã€é…ç½®çƒ­é‡è½½ã€‚                                                                                                                                                                                 |
| **æŒä¹…åŒ–**     | æµé‡å’Œè¯·æ±‚æ¬¡æ•°çš„é…é¢ç”¨é‡ä¼šè‡ªåŠ¨ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼Œé˜²æ­¢å› æœåŠ¡é‡å¯è€Œé‡ç½®ã€‚                                                                                                                                                                                             |
| **ç®¡ç†é¢æ¿**   | ç¢³è®¾è®¡é£æ ¼é™æ€ UIï¼ˆ/.admin/ï¼‰ï¼Œç™»å½•/é€€å‡ºï¼ˆ/.api/login, /.api/logoutï¼‰ã€é…ç½®ç¼–è¾‘å™¨ï¼ˆGET/POST /.api/configï¼‰ã€ç»Ÿè®¡ä»ªè¡¨ç›˜ï¼ˆ1s è‡ªåŠ¨åˆ·æ–°ï¼Œæ¶ˆè´¹ /.api/statsï¼›æœªè®¤è¯ç»´åº¦é”®åè„±æ•ã€è®¤è¯æ˜¾ç¤ºçœŸå®åç§°ï¼›æ”¯æŒ QPSã€å“åº”æ—¶é•¿å¹³å‡/æœ€çŸ­/æœ€é•¿ã€è¯·æ±‚/å“åº”åŒ…å¤§å°å¹³å‡/æœ€å°/æœ€å¤§ï¼‰ã€‚ |

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### 1. å®‰è£…

ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº† Go è¯­è¨€ç¯å¢ƒã€‚

```bash
# æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
go build .
```

### 2. é…ç½®

åˆ›å»ºä¸€ä¸ªåä¸º `config.json` çš„æ–‡ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªæœ€ç®€åŒ–çš„é…ç½®ï¼Œå®ƒå¯åŠ¨ä¸€ä¸ªåœ¨ `8080` ç«¯å£çš„ HTTP ä»£ç†ï¼Œå¹¶å°†æ‰€æœ‰å¯¹ `http://example.com` çš„è¯·æ±‚é‡å®šå‘åˆ° `http://httpbin.org`ã€‚

```json
{
  "servers": {
    "http-proxy": {
      "port": 8080
    }
  },
  "mappings": [
    {
      "from": "http://example.com/*",
      "to": "http://httpbin.org/*",
      "servers": ["http-proxy"]
    }
  ]
}
```

### 3. è¿è¡Œ

```bash
./aps -config=config.json
```

### 4. é…ç½® HTTPS æ‹¦æˆª

1. åœ¨ `config.json` ä¸­æ·»åŠ ä¸€ä¸ªæ”¯æŒ HTTPS æ‹¦æˆªçš„æœåŠ¡å™¨ï¼š
   ```json
   "https-proxy": {
     "port": 8443,
     "cert": "auto"
   }
   ```
2. å°†æ‚¨çš„ç³»ç»Ÿæˆ–æµè§ˆå™¨çš„ä»£ç†è®¾ç½®ä¸º `127.0.0.1:8443`ã€‚
3. åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä»»æ„ HTTP ç½‘ç«™ï¼Œç„¶åå¯¼èˆªåˆ° `http://<any-domain>/.ssl` (ä¾‹å¦‚ `http://example.com/.ssl`)ã€‚
4. ä¸‹è½½ `Any_Proxy_Service.crt` è¯ä¹¦æ–‡ä»¶ã€‚
5. å°†æ­¤è¯ä¹¦å¯¼å…¥åˆ°æ‚¨çš„ç³»ç»Ÿæˆ–æµè§ˆå™¨çš„â€œå—ä¿¡ä»»çš„æ ¹è¯ä¹¦é¢å‘æœºæ„â€ä¸­ã€‚

## æ ¸å¿ƒæ¦‚å¿µ

- **æœåŠ¡å™¨ (`servers`)**: ä»£ç†çš„å…¥å£ç‚¹ï¼Œå®šä¹‰äº†ç›‘å¬çš„ç«¯å£å’ŒåŸºç¡€è¡Œä¸ºã€‚æ¯ä¸ªæœåŠ¡å™¨å¯ä»¥æœ‰è‡ªå·±ç‹¬ç«‹çš„è®¤è¯ã€ç­–ç•¥å’Œæ—¥å¿—é…ç½®ã€‚
- **æ˜ å°„è§„åˆ™ (`mappings`)**: ä»£ç†çš„æ ¸å¿ƒã€‚æ¯ä¸€æ¡è§„åˆ™éƒ½å®šä¹‰äº†â€œå½“ä¸€ä¸ªè¯·æ±‚æ»¡è¶³ `from` çš„æ¡ä»¶æ—¶ï¼Œåº”è¯¥å¦‚ä½•é€šè¿‡ `to` æ¥å¤„ç†å®ƒâ€ã€‚
- **ç«¯ç‚¹é…ç½® (`EndpointConfig`)**: `from` å’Œ `to` å­—æ®µéƒ½å¯ä»¥æ˜¯ä¸€ä¸ªè¯¦ç»†çš„é…ç½®å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ URL å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå¯¹è±¡æ˜¯è¿›è¡Œé«˜çº§åŒ¹é…ã€ä¿®æ”¹å’Œåè®®è½¬æ¢çš„å…³é”®ã€‚
- **ç­–ç•¥ (`policies`)**: ç”¨äºå®šä¹‰è¿æ¥å’Œæµé‡çš„é™åˆ¶ã€‚ç­–ç•¥å¯ä»¥åº”ç”¨åœ¨æœåŠ¡å™¨ã€è§„åˆ™ã€ç”¨æˆ·ã€ç»„ç­‰å¤šä¸ªå±‚çº§ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„å°†æ˜¯æ‰€æœ‰é€‚ç”¨ç­–ç•¥ä¸­æœ€ä¸¥æ ¼çš„ä¸€ä¸ª (ä¾‹å¦‚ï¼Œæœ€ä½çš„é€Ÿç‡é™åˆ¶)ã€‚

## é…ç½®è¯¦è§£

### `servers`

å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªä»£ç†æœåŠ¡å™¨å®ä¾‹ã€‚`key` æ˜¯æœåŠ¡å™¨çš„å”¯ä¸€åç§°ã€‚

- `port`: (å¿…éœ€) `integer` ç›‘å¬ç«¯å£ã€‚
- `cert`: (å¯é€‰) `string` æˆ– `object`ã€‚ç”¨äºå¯ç”¨ HTTPSã€‚
  - å€¼ä¸º `"auto"`: è‡ªåŠ¨ç”Ÿæˆ CA è¯ä¹¦ç”¨äº HTTPS æ‹¦æˆªã€‚
  - å€¼ä¸ºä¸€ä¸ªå¯¹è±¡: `{ "cert": "path/to/cert.pem", "key": "path/to/key.pem" }`ï¼ŒæŒ‡å®šè¯ä¹¦å’Œç§é’¥æ–‡ä»¶çš„è·¯å¾„ã€‚
- `auth`: (å¯é€‰) `object`ã€‚ä¸ºæ­¤æœåŠ¡å™¨å¯ç”¨ä»£ç†è®¤è¯ã€‚
  - `users`: `array` of `string`ã€‚å…è®¸è®¿é—®çš„ç”¨æˆ·åˆ—è¡¨ã€‚
  - `groups`: `array` of `string`ã€‚å…è®¸è®¿é—®çš„ç”¨æˆ·ç»„åˆ—è¡¨ã€‚
- `dump`: (å¯é€‰) `string`ã€‚HAR æ–‡ä»¶è·¯å¾„ï¼Œç”¨äºè®°å½•é€šè¿‡æ­¤æœåŠ¡å™¨çš„æ‰€æœ‰æµé‡ã€‚
- `public`: (å¯é€‰) `boolean`ã€‚é»˜è®¤ `true`ã€‚ä¸º `true` æ—¶ç›‘å¬ `0.0.0.0:port`ï¼Œä¸º `false` æ—¶ä»…ç›‘å¬ `127.0.0.1:port`ã€‚
- `panel`: (å¯é€‰) `boolean`ã€‚é»˜è®¤ `false`ã€‚ä¸º `true` æ—¶æ³¨å†Œç®¡ç†ç«¯è·¯ç”± `/.api/*` ä¸ `/.admin/`ï¼›ä¸º `false` æ—¶ä¸æ³¨å†Œè¿™äº›è·¯ç”±ï¼ˆ`/.replay` å§‹ç»ˆå¯ç”¨ï¼‰ã€‚
- `endpoint`: (å¯é€‰) `string` æˆ– `array` of `string`ã€‚æœåŠ¡çº§é»˜è®¤ç«¯ç‚¹æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†æˆ–æœªæ¥çš„é»˜è®¤è·¯ç”±å‚è€ƒã€‚å½“å‰ç‰ˆæœ¬çš„è¯·æ±‚è½¬å‘ä»¥è§„åˆ™çº§ `via.tunnels`/`via.endpoints` ä¸ºå‡†ï¼Œ`servers.endpoint` ä¸å‚ä¸è·¯ç”±å†³ç­–ã€‚
- `tunnel`: (å¯é€‰) `string` æˆ– `array` of `string`ã€‚æœåŠ¡çº§é»˜è®¤éš§é“æ ‡ç­¾ã€‚å½“å‰ç‰ˆæœ¬çš„è¯·æ±‚è½¬å‘ä»¥è§„åˆ™çº§ `via.tunnels` ä¸ºå‡†ï¼›éš§é“æ¥å…¥æ˜¯å¦å…è®¸ç”± `tunnels.<name>.servers` æŒ‡å®šï¼ŒæœåŠ¡åœ¨è¢«æŒ‡å®šåä¼šå¼€æ”¾ `/.tunnel` ä¾›ç«¯ç‚¹å®¢æˆ·ç«¯è¿æ¥ã€‚
- `ConnectionPolicies` & `TrafficPolicies`: (å¯é€‰) ä¸ºæ­¤æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰è¿æ¥è®¾ç½®é»˜è®¤ç­–ç•¥ã€‚

**ç¤ºä¾‹:**

```json
"servers": {
  "http-proxy": {
    "port": 8080,
    "public": false
  },
  "https-proxy-with-auth": {
    "port": 8443,
    "cert": "auto",
    "panel": true,
    "auth": {
      "users": ["user1"],
      "groups": ["admin_group"]
    },
    "rateLimit": "1mbps"
  }
}
```

**è¿›ä¸€æ­¥æ¡ˆä¾‹ï¼šæœåŠ¡å™¨ä½œä¸ºéš§é“æ¥å…¥ç‚¹ä¸ç«¯ç‚¹è·¯ç”±**

- é…ç½®ç‰‡æ®µï¼š

```json
{
  "servers": {
    "edge": { "port": 3000, "panel": true }
  },
  "tunnels": {
    "my-secure-tunnel": {
      "servers": ["edge"],
      "password": "shared-secret"
    }
  },
  "mappings": [
    {
      "from": "https://remote-app.com/*",
      "to": "https://remote-app.com/*",
      "servers": ["edge"],
      "via": {
        "tunnels": "my-secure-tunnel"
      }
    },
    {
      "from": "https://remote-app.com/*",
      "to": "https://remote-app.com/*",
      "servers": ["edge"],
      "via": {
        "endpoints": "app-instance-1"
      }
    }
  ]
}
```

- ç«¯ç‚¹å®¢æˆ·ç«¯å¯åŠ¨ç¤ºä¾‹ï¼š

```bash
go run ./endpoint/main.go -server 127.0.0.1:3000 -tunnel my-secure-tunnel -name app-instance-1 -password "shared-secret"
```

- è¯´æ˜ï¼š
  - å°†æŸéš§é“ç»‘å®šåˆ°æœåŠ¡å™¨éœ€åœ¨ `tunnels.<name>.servers` ä¸­å£°æ˜ï¼›ç»‘å®šåè¯¥æœåŠ¡å™¨è‡ªåŠ¨å¼€æ”¾ `/.tunnel` æ¥å…¥ã€‚
  - æ˜ å°„è§„åˆ™ä¸­ä½¿ç”¨ `via.tunnels` æˆ– `via.endpoints` å­—æ®µå†³å®šè·¯ç”±ï¼›å½“éš§é“å†…æ— åœ¨çº¿ç«¯ç‚¹æˆ–æŒ‡å®šç«¯ç‚¹ç¦»çº¿æ—¶ä¼šå›é€€ä¸ºç›´è¿ã€‚
  - `servers.endpoint` / `servers.tunnel` å­—æ®µå½“å‰ä»…ç”¨äºæ ‡è¯†ä¸æœªæ¥é»˜è®¤è·¯ç”±æ‰©å±•ï¼›ä¸å½±å“è·¯ç”±è¡Œä¸ºã€‚

### `mappings`

å®šä¹‰è¯·æ±‚å¤„ç†è§„åˆ™çš„æ•°ç»„ã€‚è§„åˆ™æŒ‰é¡ºåºåŒ¹é…ã€‚

- `from`: (å¿…éœ€) `string` æˆ– `EndpointConfig` å¯¹è±¡ã€‚åŒ¹é…ä¼ å…¥è¯·æ±‚çš„æºã€‚
- `to`: (å¿…éœ€) `string` æˆ– `EndpointConfig` å¯¹è±¡ã€‚å®šä¹‰è¯·æ±‚çš„ç›®æ ‡ã€‚
  - **è¿œç¨‹ç›®æ ‡**: `http://...`, `https://://...`, `ws://...`
  - **æœ¬åœ°æ–‡ä»¶/ç›®å½•**: `file:///path/to/your/file` æˆ– `file://./relative/path`
- `servers`: (å¯é€‰) `array` of `string`ã€‚æ­¤è§„åˆ™é€‚ç”¨çš„æœåŠ¡å™¨åç§°åˆ—è¡¨ã€‚å¦‚æœçœç•¥ï¼Œåˆ™é€‚ç”¨äºæ‰€æœ‰æœåŠ¡å™¨ã€‚
- `via`: (å¯é€‰) `object`ã€‚é€šè¿‡è¯¥å­—æ®µé…ç½®ä»£ç†ã€éš§é“å’Œç«¯ç‚¹è·¯ç”±ã€‚
  - `proxies`: (å¯é€‰) `string` æˆ– `array` of `string`ã€‚æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªä¸Šæ¸¸ä»£ç† (åœ¨ `proxies` ä¸­å®šä¹‰)ã€‚
  - `tunnels`: (å¯é€‰) `string` æˆ– `array` of `string`ã€‚æŒ‰åç§°é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªéš§é“ (`tunnels` ä¸­å®šä¹‰)ã€‚å¦‚æœæŒ‡å®šå¤šä¸ªï¼Œå°†åœ¨å…¶ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªéš§é“å†…çš„åœ¨çº¿ç«¯ç‚¹ï¼›å½“éš§é“ä¸­æ²¡æœ‰åœ¨çº¿ç«¯ç‚¹æ—¶å›é€€ä¸ºç›´è¿ä¼ è¾“ã€‚
  - `endpoints`: (å¯é€‰) `string` æˆ– `array` of `string`ã€‚æŒ‰åç§°é€‰æ‹©å·²è¿æ¥çš„ç«¯ç‚¹å®¢æˆ·ç«¯ï¼ˆé€šè¿‡éš§é“æ³¨å†Œçš„åœ¨çº¿å®ä¾‹ï¼‰ã€‚å½“æä¾›å¤šä¸ªç«¯ç‚¹åç§°æ—¶ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªï¼›è‹¥ç›®æ ‡ç«¯ç‚¹ç¦»çº¿åˆ™å›é€€ä¸ºç›´è¿ä¼ è¾“ã€‚
  - ä¼˜å…ˆçº§ï¼š`from.proxy`ï¼ˆåœ¨ `from` çš„ EndpointConfig ä¸­å£°æ˜ï¼‰ä¼˜å…ˆäº `via.proxies`ï¼Œåˆå¹¶ä¸é€‰æ‹©é€»è¾‘è§ [processConfig()](config.go:576)ã€‚
- `cc`: (å¯é€‰) `array` of `string`ã€‚å°†è¯·æ±‚â€œæŠ„é€â€(Carbon Copy) åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé¢å¤–çš„ç›®æ ‡ URLã€‚æŠ„é€è¯·æ±‚ä¼šå¤åˆ¶åŸè¯·æ±‚çš„ Method/URL/Headers/Bodyï¼Œå¼‚æ­¥å‘é€ï¼Œä¸å½±å“ä¸»è¯·æ±‚å“åº”ï¼Œä¸”å¿½ç•¥æŠ„é€å“åº”ï¼ˆä»…è®°å½•æ—¥å¿—ï¼‰ã€‚
- `auth`: (å¯é€‰) `object`ã€‚ä¸ºæ­¤è§„åˆ™è¦†ç›–æœåŠ¡å™¨çº§åˆ«çš„è®¤è¯ï¼Œæˆ–ä¸ºæ— è®¤è¯çš„æœåŠ¡å™¨æ·»åŠ è®¤è¯ã€‚
- `dump`: (å¯é€‰) `string`ã€‚HAR æ–‡ä»¶è·¯å¾„ï¼Œä»…è®°å½•åŒ¹é…æ­¤è§„åˆ™çš„æµé‡ã€‚
- `p12`: (å¯é€‰) `string`ã€‚æŒ‡å®šä¸€ä¸ªåœ¨ `p12s` ä¸­å®šä¹‰çš„ P12 å®¢æˆ·ç«¯è¯ä¹¦ï¼Œç”¨äºä¸ç›®æ ‡æœåŠ¡å™¨è¿›è¡Œ mTLS é€šä¿¡ã€‚
- `ConnectionPolicies` & `TrafficPolicies`: (å¯é€‰) ä¸ºæ­¤è§„åˆ™è®¾ç½®ç‰¹å®šçš„ç­–ç•¥ã€‚

#### `EndpointConfig` å¯¹è±¡è¯¦è§£

`from` å’Œ `to` å­—æ®µéƒ½å¯ä»¥ä½¿ç”¨æ­¤å¯¹è±¡è¿›è¡Œé«˜çº§é…ç½®ã€‚

- `url`: (å¿…éœ€) `string`ã€‚URL å­—ç¬¦ä¸²ã€‚
  - **é€šé…ç¬¦**: `*` å¯ç”¨äºåŒ¹é…è·¯å¾„çš„å…¶ä½™éƒ¨åˆ†ï¼Œä¾‹å¦‚ `http://api.example.com/v1/*`ã€‚
  - **åè®®åŒ¹é…**: `from.url` çš„åè®®å¤´ä¼šç²¾ç¡®åŒ¹é…è¯·æ±‚åè®®ã€‚
    - `http://`: åªåŒ¹é… HTTP è¯·æ±‚ã€‚
    - `https://`: åªåŒ¹é… HTTPS è¯·æ±‚ã€‚
    - `ws://` / `wss://`: åŒ¹é… WebSocket å‡çº§è¯·æ±‚ã€‚
    - `*://`: åŒ¹é…ä»»ä½•åè®®ã€‚
  - **æ­£åˆ™åŒ¹é…**: æ”¯æŒåœ¨ `from.url` ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¸æ•è·ç»„æ›¿æ¢ï¼Œè¯¦è§ [é…ç½®æŒ‡å—](CONFIGURATION_GUIDE.md:1) çš„â€œæ­£åˆ™è¡¨è¾¾å¼ URL åŒ¹é…â€ç« èŠ‚ã€‚
- `method`: (å¯é€‰) `string` æˆ– `array` of `string`ã€‚åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ª HTTP æ–¹æ³•ï¼Œä¾‹å¦‚ `"POST"` æˆ– `["GET", "POST"]`ã€‚
- `headers`: (å¯é€‰) `object`ã€‚åŒ¹é…æˆ–ä¿®æ”¹æ ‡å¤´ã€‚
  - `{"Header-Name": "value"}`: åœ¨ `from` ä¸­ç”¨äºåŒ¹é…ï¼Œåœ¨ `to` ä¸­ç”¨äºæ·»åŠ æˆ–è¦†ç›–ã€‚
  - `{"Header-Name": null}`: åœ¨ `to` ä¸­ç”¨äºç§»é™¤æ ‡å¤´ã€‚
  - `{"Header-Name": ["val1", "val2"]}`: åœ¨ `to` ä¸­ç”¨äºä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå€¼ã€‚
  - ç‰¹æ®Šè¯´æ˜ï¼šå½“å€¼ä¸ºæ•°ç»„æ—¶ä¼šéšæœºé€‰æ‹©ï¼Œå…¶ä¸­ `Authorization` é”®çš„å€¼ä¼šåœ¨æ—¥å¿—ä¸­è¿›è¡Œè„±æ•å±•ç¤ºï¼Œå‚è§ [EndpointConfig.GetHeader()](config.go:176)ã€‚
- `querystring`: (å¯é€‰) `object`ã€‚åŒ¹é…æˆ–ä¿®æ”¹æŸ¥è¯¢å‚æ•°ã€‚ç”¨æ³•åŒ `headers`ã€‚
- `proxy`: (å¯é€‰) `string` æˆ– `array` of `string` æˆ–æœ¬åœ°/è¿œç¨‹æ–‡ä»¶è·¯å¾„ã€‚ä¸ºè¯¥ç«¯ç‚¹å•ç‹¬æŒ‡å®šä¸Šæ¸¸ä»£ç†ï¼š
  - ç›´æ¥å¡«å†™ä»£ç† URLï¼ˆæ”¯æŒ `http://`ã€`https://`ã€`socks5://`ï¼‰ã€‚
  - æŒ‡å‘æœ¬åœ°æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œæ¯è¡Œä¸€ä¸ªä»£ç†ï¼›æˆ–è¿œç¨‹ `.txt`/`.json` åˆ—è¡¨ URLï¼Œç³»ç»Ÿä¼šå®šæ—¶ï¼ˆæ¯ 5 åˆ†é’Ÿï¼‰è‡ªåŠ¨æ›´æ–°ã€‚
    - å½“ä¸ `via.proxies` åŒæ—¶å­˜åœ¨æ—¶ï¼Œ`from.proxy` ä¼˜å…ˆï¼Œå‚è§ [processConfig()](config.go:576)ã€‚
- `script`: (å¯é€‰) `string`ã€‚æŒ‡å®šç”¨äºå¤„ç†è¯·æ±‚æˆ–å“åº”çš„è„šæœ¬è·¯å¾„ã€‚
  - åœ¨ `from` ä¸­ä½¿ç”¨: è„šæœ¬åœ¨ **è¯·æ±‚** å‘é€åˆ°ç›®æ ‡ä¹‹å‰æ‰§è¡Œã€‚
  - åœ¨ `to` ä¸­ä½¿ç”¨: è„šæœ¬åœ¨ä»ç›®æ ‡æ”¶åˆ° **å“åº”** ä¹‹åæ‰§è¡Œã€‚
- `grpc`: (å¯é€‰) `GRPCConfig` å¯¹è±¡ã€‚ç”¨äº gRPC ä»£ç†å’Œè½¬æ¢ã€‚
- `websocket`: (å¯é€‰) `WebSocketConfig` å¯¹è±¡ã€‚ç”¨äº WebSocket æ¶ˆæ¯æ‹¦æˆªã€‚

**ç¤ºä¾‹: é«˜çº§æ˜ å°„è§„åˆ™**

```json
"mappings": [
  {
    "from": "http://api.service.com/users/*",
    "to": "http://internal.service.com/users/*",
    "servers": ["http-proxy"],
    "cc": ["http://log-service/ingress", "http://audit-service/new-request"]
  },
  {
    "from": "http://remote-app.com/*",
    "to": "http://remote-app.com/*",
    "via": {
      "tunnels": "my-secure-tunnel",
      "endpoints": "app-instance-1"
    }
  }
]
```

#### ccï¼ˆCarbon Copyï¼‰æŠ„é€

- è¡Œä¸ºï¼šå¯¹æ¯ä¸ªåŒ¹é…çš„åŸè¯·æ±‚ï¼Œå¼‚æ­¥å†å‘èµ·ä¸€ä»½ç›¸åŒçš„è¯·æ±‚åˆ° `cc` åˆ—è¡¨ä¸­çš„ç›®æ ‡ URLã€‚
- ç»†èŠ‚ï¼š
  - å¤åˆ¶ Methodã€URLã€Headers ä¸ Bodyï¼›æŠ„é€å“åº”ä¸å‚ä¸ä¸»æµç¨‹ï¼Œä»…åšæ—¥å¿—è®°å½•ã€‚
  - æŠ„é€å¤±è´¥ä¸ä¼šå½±å“ä¸»è¯·æ±‚çš„æˆåŠŸä¸å¦ã€‚
  - å¤§ä½“ç§¯ Body ä¼šè¢«è¯»å–å¹¶å¤ç”¨ä¸€ä»½ç”¨äºä¸»è¯·æ±‚ï¼Œæ³¨æ„å†…å­˜å ç”¨ã€‚
- ç¤ºä¾‹ï¼š

```json
{
  "from": "https://api.example.com/v1/events",
  "to": "https://collector.internal/v1/events",
  "cc": [
    "https://audit.service.local/ingest",
    "https://ml.service.local/learn"
  ]
}
```

#### Via é…ç½®å¯¹è±¡

`via` å­—æ®µæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å¯¹è±¡ï¼Œç”¨äºé…ç½®ä»£ç†ã€éš§é“å’Œç«¯ç‚¹è·¯ç”±ã€‚å®ƒæä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„æ–¹å¼æ¥æŒ‡å®šè¯·æ±‚çš„ä¸­é—´è·¯ç”±ã€‚

- `proxies`: æŒ‡å®šä¸Šæ¸¸ä»£ç†æœåŠ¡å™¨
- `tunnels`: æŒ‡å®šéš§é“è¿›è¡Œç«¯ç‚¹è·¯ç”±
- `endpoints`: ç›´æ¥æŒ‡å®šç«¯ç‚¹è¿›è¡Œè·¯ç”±

**é…ç½®ä¼˜å…ˆçº§**ï¼š
1. `from.proxy`ï¼ˆç«¯ç‚¹é…ç½®ä¸­çš„ä»£ç†ï¼‰ä¼˜å…ˆçº§æœ€é«˜
2. `via.proxies`ï¼ˆviaå¯¹è±¡ä¸­çš„ä»£ç†ï¼‰æ¬¡ä¹‹
3. è§„åˆ™çº§çš„ç‹¬ç«‹ä»£ç†å­—æ®µï¼ˆå·²åºŸå¼ƒï¼‰

#### éš§é“ä¸ç«¯ç‚¹è·¯ç”±ï¼ˆvia.tunnels / via.endpointsï¼‰

- `via.tunnels`: é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªéš§é“åç§°ï¼Œç³»ç»Ÿå°†ä»ç›®æ ‡éš§é“ä¸­éšæœºæŒ‘é€‰åœ¨çº¿ç«¯ç‚¹è½¬å‘è¯·æ±‚ï¼›è‹¥éš§é“å†…æ— åœ¨çº¿ç«¯ç‚¹åˆ™å›é€€ä¸ºç›´è¿ã€‚
- `via.endpoints`: ç›´æ¥æŒ‰åç§°é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªå…·ä½“ç«¯ç‚¹ï¼ˆè·¨éš§é“å…¨å±€æŸ¥æ‰¾ï¼‰ï¼ŒéšæœºæŒ‘é€‰åœ¨çº¿å®ä¾‹ï¼›è‹¥ç›®æ ‡ç«¯ç‚¹ç¦»çº¿åˆ™å›é€€ä¸ºç›´è¿ã€‚
- ä½¿ç”¨æ­¥éª¤ï¼š

  1) åœ¨é…ç½®ä¸­å®šä¹‰ `tunnels` å¹¶å°†å…¶ç»‘å®šåˆ°ä¸€ä¸ªæˆ–å¤šä¸ªç›‘å¬ `servers`ï¼ˆè¯¦è§æœ¬æ–‡ä¸‹æ–¹ `tunnels` å°èŠ‚ï¼‰ã€‚
  2) åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œç«¯ç‚¹å®¢æˆ·ç«¯ï¼Œä½¿å…¶ä»¥æŸä¸ª `-name` æŒ‚åˆ°æŒ‡å®š `-tunnel` ä¸‹ã€‚
  3) åœ¨æ˜ å°„è§„åˆ™ä¸­ä½¿ç”¨ `via.tunnels` æˆ– `via.endpoints` å­—æ®µè¿›è¡Œè·¯ç”±ã€‚
- ç«¯ç‚¹å®¢æˆ·ç«¯å¯åŠ¨ç¤ºä¾‹ï¼š

```bash
go run ./endpoint/main.go -server 127.0.0.1:3000 -tunnel my-secure-tunnel -name app-instance-1 -password "your-aes-password"
```

- æŒ‰éš§é“è·¯ç”±ç¤ºä¾‹ï¼ˆåœ¨éš§é“å†…æŒ‘ä»»ä¸€åœ¨çº¿ç«¯ç‚¹ï¼‰ï¼š

```json
{
  "from": "https://remote-app.com/*",
  "to": "https://remote-app.com/*",
  "via": {
    "tunnels": ["my-secure-tunnel", "backup-tunnel"]
  }
}
```

- æŒ‰ç«¯ç‚¹åè·¯ç”±ç¤ºä¾‹ï¼ˆè·¨éš§é“æŸ¥æ‰¾æŒ‡å®šç«¯ç‚¹åï¼‰ï¼š

```json
{
  "from": "https://remote-app.com/*",
  "to": "https://remote-app.com/*",
  "via": {
    "endpoints": ["app-instance-1", "app-instance-2"]
  }
}
```

### `proxies`

å®šä¹‰å¯ä¾› `mappings` ä½¿ç”¨çš„ä¸Šæ¸¸ä»£ç†æ± ã€‚`key` æ˜¯ä»£ç†çš„å”¯ä¸€åç§°ã€‚

- `urls`: (å¿…éœ€) `array` of `string`ã€‚ä¸Šæ¸¸ä»£ç†æœåŠ¡å™¨çš„ URL åˆ—è¡¨ã€‚å¦‚æœæä¾›å¤šä¸ªï¼Œå°†è¿›è¡Œè½®è¯¢ã€‚
- `ConnectionPolicies` & `TrafficPolicies`: (å¯é€‰) ä¸ºé€šè¿‡æ­¤ä»£ç†çš„è¿æ¥è®¾ç½®ç­–ç•¥ã€‚

**ç¤ºä¾‹:**

```json
"proxies": {
  "datacenter-a": {
    "urls": ["http://user:pass@proxy-a1.com:8080", "http://user:pass@proxy-a2.com:8080"]
  },
  "datacenter-b": {
    "urls": ["socks5://proxy-b.com:1080"]
  }
}
```

### `tunnels`

å®šä¹‰å¯è¢«ç«¯ç‚¹å®¢æˆ·ç«¯è¿æ¥çš„éš§é“ã€‚ç«¯ç‚¹é€šè¿‡ WebSocket è¿æ¥åˆ°æœåŠ¡å™¨çš„ `/.tunnel` è·¯å¾„ï¼Œå¹¶ä»¥æŸä¸ªåç§°æ³¨å†Œåˆ°æŒ‡å®šéš§é“ä¸‹ã€‚æ˜ å°„è§„åˆ™ä¸­çš„ `via.tunnels` ä¸ `via.endpoints` ä¾èµ–æ­¤å¤„å®šä¹‰åŠç«¯ç‚¹åœ¨çº¿çŠ¶æ€ã€‚

- `servers`: (å¿…éœ€) `array` of `string`ã€‚å…è®¸æ­¤éš§é“åœ¨è¿™äº›ç›‘å¬æœåŠ¡ä¸Šæ¥å…¥ç«¯ç‚¹ï¼ˆè¿™äº› server ä¼šæ¥å—ç«¯ç‚¹åˆ° `/.tunnel` çš„æ¥å…¥ï¼‰ã€‚
- `password`: (å¯é€‰) `string`ã€‚ç”¨äºéš§é“å†…è¯·æ±‚/å“åº”æ•°æ®çš„ AES-GCM åŠ å¯†å¯†é’¥ï¼›ä¸ºç©ºåˆ™ä¸åŠ å¯†ã€‚
- `auth`: (å¯é€‰) `object`ã€‚å¯¹é€šè¿‡è¯¥éš§é“è·¯ç”±çš„è¯·æ±‚æ–½åŠ çš„è®¿é—®æ§åˆ¶ï¼ˆå­—æ®µåŒ `mappings.auth` çš„ `users`/`groups`ï¼‰ã€‚
- `ConnectionPolicies` & `TrafficPolicies`: (å¯é€‰) åº”ç”¨äºé€šè¿‡è¯¥éš§é“è·¯ç”±çš„è¿æ¥/æµé‡ç­–ç•¥ï¼ˆå¦‚ `rateLimit`ã€`trafficQuota`ã€`requestQuota`ï¼‰ã€‚

**ç¤ºä¾‹:**

```json
"tunnels": {
  "my-secure-tunnel": {
    "servers": ["main-gateway"],
    "password": "shared-secret",
    "rateLimit": "5mbps",
    "trafficQuota": "10gb"
  },
  "edge-pop": {
    "servers": ["http-proxy", "https-proxy-with-auth"]
  }
}
```

ç«¯ç‚¹å®¢æˆ·ç«¯è¿è¡Œç¤ºä¾‹ï¼š

```bash
go run ./endpoint/main.go -server 127.0.0.1:3000 -tunnel my-secure-tunnel -name app-instance-1 -password "shared-secret"
```

### `auth`

å®šä¹‰ç”¨æˆ·ã€ç»„å’Œè®¿é—®ç­–ç•¥ã€‚

- `users`: `object`ã€‚`key` æ˜¯ç”¨æˆ·åã€‚
  - `password`: (å¿…éœ€) `string`ã€‚ç”¨æˆ·å¯†ç ã€‚
  - `groups`: (å¯é€‰) `array` of `string`ã€‚ç”¨æˆ·æ‰€å±çš„ç»„ã€‚
  - `ConnectionPolicies` & `TrafficPolicies`: (å¯é€‰) ä¸ºæ­¤ç”¨æˆ·è®¾ç½®ç‰¹å®šçš„ç­–ç•¥ã€‚
- `groups`: `object`ã€‚`key` æ˜¯ç»„åã€‚
  - `ConnectionPolicies` & `TrafficPolicies`: (å¯é€‰) ä¸ºæ­¤ç»„è®¾ç½®ç‰¹å®šçš„ç­–ç•¥ã€‚

**ç­–ç•¥ç»§æ‰¿ä¸ä¼˜å…ˆçº§**:
æœ€ç»ˆç”Ÿæ•ˆçš„ç­–ç•¥æ˜¯æ‰€æœ‰é€‚ç”¨ç­–ç•¥ä¸­æœ€ä¸¥æ ¼çš„ä¸€ä¸ªã€‚ç­–ç•¥åº”ç”¨çš„å±‚çº§é¡ºåºä¸ºï¼šæœåŠ¡å™¨ -> æ˜ å°„è§„åˆ™ -> ç”¨æˆ· -> ç»„ã€‚

å…·ä½“è§„åˆ™ï¼š
- **è¿æ¥ç­–ç•¥**ï¼šå–æ‰€æœ‰é€‚ç”¨ç­–ç•¥ä¸­çš„æœ€å°å€¼ï¼ˆæœ€ä¸¥æ ¼å€¼ï¼‰
  - `timeout`ï¼šæœ€å°è¶…æ—¶æ—¶é—´ç”Ÿæ•ˆ
  - `idleTimeout`ï¼šæœ€å°ç©ºé—²è¶…æ—¶æ—¶é—´ç”Ÿæ•ˆ
  - `maxThread`ï¼šæœ€å°çº¿ç¨‹æ•°é™åˆ¶ç”Ÿæ•ˆ
  - `quality`ï¼šæœ€å°è´¨é‡ç³»æ•°ç”Ÿæ•ˆ
- **æµé‡ç­–ç•¥**ï¼šé€Ÿç‡é™åˆ¶å–æœ€å°å€¼ï¼Œé…é¢æŒ‰å±‚çº§åˆ†åˆ«ç´¯ç§¯
  - `rateLimit`ï¼šæœ€å°é€Ÿç‡é™åˆ¶ç”Ÿæ•ˆ
  - `trafficQuota`ï¼šå„å±‚çº§é…é¢åˆ†åˆ«è·Ÿè¸ªï¼Œä»»æ„å±‚çº§è¶…å‡ºéƒ½ä¼šè§¦å‘é™åˆ¶
  - `requestQuota`ï¼šå„å±‚çº§é…é¢åˆ†åˆ«è·Ÿè¸ªï¼Œä»»æ„å±‚çº§è¶…å‡ºéƒ½ä¼šè§¦å‘é™åˆ¶

ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨é™åˆ¶ `1mbps`ï¼Œç”¨æˆ·é™åˆ¶ `500kbps`ï¼Œåˆ™æœ€ç»ˆé€Ÿç‡ä¸º `500kbps`ã€‚

**ç¤ºä¾‹:**

```json
"auth": {
  "users": {
    "john": {
      "password": "password123",
      "groups": ["developers"],
      "trafficQuota": "10gb"
    },
    "guest": {
      "password": "guest",
      "rateLimit": "100kbps"
    }
  },
  "groups": {
    "developers": {
      "rateLimit": "10mbps"
    }
  }
}
```

### `scripting`

é…ç½®è„šæœ¬è§£é‡Šå™¨çš„è·¯å¾„ã€‚å¦‚æœç•™ç©ºï¼Œç³»ç»Ÿä¼šå°è¯•ä» `PATH` ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾ã€‚

- `pythonPath`: (å¯é€‰) `string`ã€‚Python è§£é‡Šå™¨çš„è·¯å¾„ (ä¾‹å¦‚ `/usr/bin/python3`)ã€‚
- `nodePath`: (å¯é€‰) `string`ã€‚Node.js è§£é‡Šå™¨çš„è·¯å¾„ã€‚

### `p12s`

å®šä¹‰ P12/PFX å®¢æˆ·ç«¯è¯ä¹¦ï¼Œç”¨äº mTLS è®¤è¯ã€‚`key` æ˜¯è¯ä¹¦çš„å”¯ä¸€åç§°ã€‚

- `path`: (å¿…éœ€) `string`ã€‚`.p12` æˆ– `.pfx` æ–‡ä»¶çš„è·¯å¾„ã€‚
- `password`: (å¿…éœ€) `string`ã€‚è¯ä¹¦çš„å¯†ç ã€‚

**ç¤ºä¾‹:**

```json
"p12s": {
  "my-client-cert": {
    "path": "./certs/client.p12",
    "password": "cert-password"
  }
}
```

### `quotaUsage`

æ­¤å­—æ®µç”± Any Proxy Service è‡ªåŠ¨ç®¡ç†ï¼Œç”¨äºæŒä¹…åŒ–æµé‡å’Œè¯·æ±‚æ¬¡æ•°çš„é…é¢ç”¨é‡ã€‚**è¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹**ã€‚

é…é¢ç”¨é‡ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `data.json` æ–‡ä»¶ï¼ˆå¯åœ¨å¯åŠ¨æ—¶é€šè¿‡ `-data` å‚æ•°æŒ‡å®šï¼‰ï¼Œå¹¶åœ¨æœåŠ¡é‡å¯åè‡ªåŠ¨æ¢å¤ã€‚è¿™ç¡®ä¿äº†é…é¢é™åˆ¶åœ¨æœåŠ¡é‡å¯åä»ç„¶æœ‰æ•ˆï¼Œä¸ä¼šå› ä¸ºé‡å¯è€Œé‡ç½®ç”¨é‡è®¡æ•°ã€‚

æ•°æ®æ–‡ä»¶ç»“æ„ç¤ºä¾‹ï¼š
```json
{
  "quotaUsage": {
    "user:john": {
      "trafficUsed": 1073741824,
      "requestsUsed": 1500
    },
    "group:developers": {
      "trafficUsed": 5368709120,
      "requestsUsed": 8500
    }
  }
}
```

## é«˜çº§åŠŸèƒ½ä¸ç”¨ä¾‹

### æµé‡ç­–ç•¥ (Policies)

- `timeout`: `integer` (ç§’)ã€‚è¿æ¥è¶…æ—¶ã€‚
- `idleTimeout`: `integer` (ç§’)ã€‚ç©ºé—²è¿æ¥è¶…æ—¶ã€‚
- `maxThread`: `integer`ã€‚å¹¶å‘è¿æ¥æ•°é™åˆ¶ã€‚
- `quality`: `float` (0.0 åˆ° 1.0)ã€‚ä¼ è¾“è´¨é‡ç³»æ•°ï¼ˆå¸¦å®½å€ç‡ï¼‰ï¼Œ1.0 è¡¨ç¤ºæ»¡é€Ÿï¼Œ0.5 è¡¨ç¤ºä»¥ 50% å¸¦å®½ä¼ è¾“ï¼ˆä¸åšä¸¢åŒ…ï¼Œä»…é™é€Ÿï¼‰ã€‚æ³¨æ„ï¼šè¿™æ˜¯å¸¦å®½å€ç‡ï¼Œä¸æ˜¯ä¸¢åŒ…ç‡ã€‚
- `rateLimit`: `string` (e.g., "500kbps", "2mbps")ã€‚é€Ÿç‡é™åˆ¶ã€‚
- `trafficQuota`: `string` (e.g., "10gb", "500mb")ã€‚æ€»æµé‡é…é¢ã€‚
- `requestQuota`: `integer`ã€‚æ€»è¯·æ±‚æ¬¡æ•°é…é¢ã€‚

**ç¤ºä¾‹: æ¨¡æ‹Ÿå¼±ç½‘ç¯å¢ƒ**

```json
"mappings": [
  {
    "from": "http://*.mobile-api.com/*",
    "to": "http://backend.mobile-api.com/*",
    "quality": 0.8, // 80% å¸¦å®½ï¼ˆé™é€Ÿï¼‰ï¼Œä¸åšä¸¢åŒ…
    "rateLimit": "256kbps" // æ¨¡æ‹Ÿ 2G/3G ç½‘ç»œé€Ÿåº¦
  }
]
```

### è„šæœ¬åŒ–ä¿®æ”¹ (Scripting)

ä½¿ç”¨ Python æˆ– Node.js è„šæœ¬åœ¨è¯·æ±‚æˆ–å“åº”é˜¶æ®µåŠ¨æ€ä¿®æ”¹æµé‡ã€‚

- åœ¨ `from` è§„åˆ™ä¸­å®šä¹‰çš„ `script` ä¼šåœ¨è¯·æ±‚è¢«å‘é€åˆ°ç›®æ ‡æœåŠ¡å™¨ **ä¹‹å‰** æ‰§è¡Œã€‚
- åœ¨ `to` è§„åˆ™ä¸­å®šä¹‰çš„ `script` ä¼šåœ¨æ”¶åˆ°ç›®æ ‡æœåŠ¡å™¨çš„å“åº” **ä¹‹å** æ‰§è¡Œã€‚

è„šæœ¬é€šè¿‡æ ‡å‡†è¾“å…¥æ¥æ”¶ä¸€ä¸ª JSON å¯¹è±¡ï¼Œå¹¶é€šè¿‡æ ‡å‡†è¾“å‡ºè¿”å›ä¸€ä¸ªä¿®æ”¹åçš„ JSON å¯¹è±¡ã€‚

**JSON ç»“æ„:**

```json
{
  "method": "GET",
  "url": "http://example.com/path?a=1",
  "headers": { ... },
  "body": "base64-encoded-body", // body æ˜¯ base64 ç¼–ç çš„
  // ä»… onResponse
  "status_code": 200,
  "status_text": "OK"
}
```

**ç¤ºä¾‹: ä½¿ç”¨ Python è„šæœ¬æ·»åŠ  HMAC ç­¾å**

```json
// config.json
"from": {
  "url": "http://api.mycorp.com/v1/*",
  "script": "./scripts/add_hmac.py"
},
"to": "http://internal.api/*"
```

```python
# scripts/add_hmac.py
import sys
import json
import hmac
import hashlib
import base64
from datetime import datetime

def main():
    data = json.load(sys.stdin)
    secret_key = "my-secret-key"
  
    timestamp = str(datetime.utcnow().timestamp())
    body = base64.b64decode(data.get("body", "")).decode('utf-8')
  
    message = f"{timestamp}{data['method']}{data['url']}{body}"
  
    signature = hmac.new(
        secret_key.encode('utf-8'),
        message.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
  
    data["headers"]["X-Timestamp"] = timestamp
    data["headers"]["X-Signature"] = signature
  
    json.dump(data, sys.stdout)

if __name__ == "__main__":
    main()
```

### åè®®ç½‘å…³

#### gRPC ä»£ç†

æ ¹æ® gRPC çš„æœåŠ¡ã€æ–¹æ³•å’Œå…ƒæ•°æ®æ¥è·¯ç”±å’Œä¿®æ”¹æµé‡ã€‚

```json
"mappings": [
  {
    "from": {
      "url": "*://grpc.example.com:443/*",
      "grpc": {
        "service": "myapp.UserService",
        "method": "GetUser",
        "metadata": { "source": "any-proxy" } // æ·»åŠ /è¦†ç›–è¯·æ±‚å…ƒæ•°æ®
      }
    },
    "to": {
      "url": "http://localhost:50051"
    }
  }
]
```

#### WebSocket æ¶ˆæ¯æ‹¦æˆª

æ‹¦æˆªã€æ£€æŸ¥å’Œä¿®æ”¹å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„åŒå‘ WebSocket æ¶ˆæ¯ã€‚

- `intercept_client_messages`: å¤„ç†ä»å®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚
- `intercept_server_messages`: å¤„ç†ä»æœåŠ¡å™¨å‘å¾€å®¢æˆ·ç«¯çš„æ¶ˆæ¯ã€‚

æ¯ä¸ªè§„åˆ™æ”¯æŒ `match` (æ­£åˆ™)ã€`replace`ã€`log` å’Œ `drop` æ“ä½œã€‚

```json
"mappings": [
  {
    "from": "ws://chat.example.com/ws",
    "to": "ws://backend-chat:8000/ws",
    "websocket": {
      "intercept_client_messages": [
        {
          "match": "\"type\":\"private_message\"",
          "log": true, // è®°å½•æ‰€æœ‰ç§ä¿¡
          "drop": true // å¹¶ä¸¢å¼ƒå®ƒä»¬
        }
      ],
      "intercept_server_messages": [
        {
          "match": "token=([a-zA-Z0-9]+)",
          "replace": { "token=([a-zA-Z0-9]+)": "token=REDACTED" } // éšè— token
        }
      ]
    }
  }
]
```

#### åŠ¨æ€ REST-to-gRPC è½¬æ¢

å°†ä¸€ä¸ªæ ‡å‡†çš„ RESTful API è¯·æ±‚åŠ¨æ€åœ°è½¬æ¢ä¸ºå¯¹åç«¯ gRPC æœåŠ¡çš„è°ƒç”¨ï¼Œ**æ— éœ€é¢„å…ˆç”Ÿæˆä»»ä½•ä»£ç **ã€‚

- `rest_to_grpc`:
  - `request_body_mapping`: å®šä¹‰å¦‚ä½•ä» HTTP è¯·æ±‚çš„å„ä¸ªéƒ¨åˆ† (JSON body, URL æŸ¥è¯¢å‚æ•°, URL è·¯å¾„å˜é‡) æ„å»º gRPC è¯·æ±‚æ¶ˆæ¯ã€‚
    - `"grpc_field": "json:http_json_field"`
    - `"grpc_field": "query:http_query_param"`
    - `"grpc_field": "path:url_path_variable"`

**ç¤ºä¾‹: å°† RESTful ç”¨æˆ·åˆ›å»ºè¯·æ±‚è½¬æ¢ä¸º gRPC è°ƒç”¨**

```json
// POST http://api.example.com/v1/users/admin
// Body: { "user_name": "John Doe", "user_email": "john.doe@example.com" }
{
  "from": {
    "url": "http://api.example.com/v1/users/{role_id}",
    "method": "POST",
    "grpc": {
      "service": "myapp.UserService",
      "method": "CreateUser",
      "rest_to_grpc": {
        "request_body_mapping": {
          "name": "json:user_name",
          "email": "json:user_email",
          "role_id": "path:role_id"
        }
      }
    }
  },
  "to": "http://localhost:50051" // gRPC åç«¯åœ°å€
}
```

## ç®¡ç†ç«¯ç‚¹

- `/.ssl`: è¯ä¹¦å®‰è£…é¡µé¢ä¸æ ¹ CA ä¸‹è½½ï¼Œæ–‡ä»¶å `Any_Proxy_Service.crt`ã€‚
- `/.api/stats`: å®æ—¶ç»Ÿè®¡ JSONï¼ˆå·²æ›¿æ¢æ—§è·¯å¾„ `/.stats`ï¼‰ã€‚æœªè®¤è¯æ—¶å¯¹ `rules`/`users`/`servers`/`tunnels`/`proxies` é”®åè¿›è¡Œè„±æ•ï¼›è®¤è¯åæ˜¾ç¤ºçœŸå®åç§°ã€‚æŒ‡æ ‡åŒ…å«ï¼š
  - QPSï¼ˆæŒ‰é¦–æœ«è¯·æ±‚æ—¶é—´çª—å£è®¡ç®—ï¼Œçª—å£ < 1s æ—¶é€€åŒ–ä¸ºè¯·æ±‚æ•°ï¼‰
  - å“åº”æ—¶é•¿ å¹³å‡/æœ€çŸ­/æœ€é•¿ï¼ˆæ¯«ç§’ï¼‰
  - è¯·æ±‚åŒ…/å“åº”åŒ…å¤§å° å¹³å‡/æœ€å°/æœ€å¤§
  - è¯·æ±‚æ•°ã€é”™è¯¯æ•°ã€æ€»å­—èŠ‚
- `/.replay`: é‡æ”¾æ•è·çš„è¯·æ±‚ã€‚
- `/.admin/`: ç®¡ç†é¢æ¿é™æ€èµ„æºï¼ˆCarbon æ ·å¼ï¼‰ï¼Œä» `./admin-ui/dist` æä¾›ã€‚

### ç®¡ç†é¢æ¿ API ä¸è®¤è¯

- åç«¯ APIï¼š
  - `POST /.api/login`: ç®¡ç†å‘˜ç™»å½•ï¼ŒæˆåŠŸåè¿”å› `token` å¹¶è®¾ç½® HttpOnly Cookie `APS-Admin-Token`ã€‚
  - `POST /.api/logout`: é€€å‡ºç™»å½•ï¼Œæ¸…ç†ä¼šè¯ä¸ Cookieã€‚
  - `GET /.api/config`: è¯»å–é…ç½®ï¼ˆéœ€ç®¡ç†å‘˜ä»¤ç‰Œï¼‰ã€‚
  - `POST /.api/config`: å†™å…¥é…ç½®ï¼ˆéœ€ç®¡ç†å‘˜ä»¤ç‰Œï¼Œä¿å­˜åè§¦å‘çƒ­é‡è½½ï¼‰ã€‚
- è®¤è¯æ–¹å¼ï¼š
  - ä¼šè¯ Cookieï¼š`APS-Admin-Token`ï¼ˆé€šè¿‡ç™»å½•æ¥å£å‘æ”¾ï¼Œ24h è¿‡æœŸï¼‰ã€‚
  - Bearer Tokenï¼š`Authorization: Bearer <token>`ï¼Œæ¥æºäº `config.json -> auth.users[].token`ï¼Œä¸”è¯¥ç”¨æˆ·éœ€ `admin: true`ã€‚
- è„±æ•è§„åˆ™ï¼š
  - æœªè®¤è¯è®¿é—® `/.api/stats` æ—¶ï¼Œç»´åº¦é”®åä»¥ `md5(key + timestamp)` è¿”å›ï¼›è®¤è¯åè¿”å›çœŸå®é”®åã€‚
- å‰ç«¯é™æ€ï¼š
  - `/.admin/`: ä» `./admin-ui/dist` ç›®å½•æä¾›ç®¡ç†ç•Œé¢é™æ€æ–‡ä»¶ï¼ŒåŒ…å«ç»Ÿè®¡ä»ªè¡¨ç›˜ï¼ˆ1s è‡ªåŠ¨åˆ·æ–°ï¼‰ã€é…ç½®ç¼–è¾‘å™¨ã€ç™»å½•/é€€å‡ºã€‚

### HTTPS CONNECT æ‹¦æˆªç­–ç•¥

- è‡ªåŠ¨åˆ¤å®šæ˜¯å¦è¿›è¡Œ MITMï¼š
  - è‹¥å­˜åœ¨ä»¥ `https://{host}` å‰ç¼€åŒ¹é…çš„æ˜ å°„è§„åˆ™ï¼Œåˆ™å¯¹è¯¥ä¸»æœºçš„ CONNECT è¿›è¡Œæ‹¦æˆªå¹¶ç”Ÿæˆä¼ªé€ è¯ä¹¦è¿›è¡Œè§£å¯†ï¼ˆMITMï¼‰ã€‚
  - å¦åˆ™ä»¥çº¯éš§é“æ–¹å¼ç›´è¿ç›®æ ‡ä¸»æœºï¼Œä¸è§£å¯†å†…å®¹ã€‚
- è¯ä¹¦ä¸‹è½½ä¸ä¿¡ä»»ï¼š
  - å°† server çš„ `cert` è®¾ä¸º `"auto"` åï¼Œå¯åœ¨è¯¥æœåŠ¡è®¿é—® `/.ssl` ä¸‹è½½æ ¹ CA å¹¶å®‰è£…ä¿¡ä»»ã€‚
- å‚è€ƒå®ç°ï¼š[handleConnectWithIntercept()](connect_handler.go:15)ã€[shouldInterceptHost()](connect_handler.go:35)ã€[TlsListener](tls_listener.go:9)ã€‚

### WebSocket è·¯ç”±ä¸åŒ¹é…è¯´æ˜

- `from.url` æ”¯æŒ `ws://` / `wss://` ä½œä¸ºåè®®åŒ¹é…ï¼š
  - `ws://` åŒ¹é…å°†è¦å‡çº§ä¸º WebSocket çš„ HTTP è¯·æ±‚ï¼›
  - `wss://` åŒ¹é…å°†è¦å‡çº§ä¸º WebSocket çš„ HTTPS è¯·æ±‚ï¼›
  - å®é™…è½¬å‘æ—¶ï¼Œåç«¯ç›®æ ‡ä¼šè‡ªåŠ¨è½¬æ¢ä¸º `ws`/`wss` åè®®è¿æ¥ã€‚
- å¯åœ¨ `from.websocket` ä¸­é…ç½®æ¶ˆæ¯æ‹¦æˆªè§„åˆ™ï¼Œå¯¹å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ–¹å‘åˆ†åˆ«è¿›è¡Œ `match`ã€`replace`ã€`log`ã€`drop` æ“ä½œã€‚
- å‚è€ƒå®ç°ï¼š[handleWebSocket()](websocket_handler.go:14)ã€‚

## é…ç½®çƒ­é‡è½½ä¸æœåŠ¡å™¨åŒæ­¥

- æ”¯æŒé…ç½®æ–‡ä»¶çƒ­é‡è½½ï¼Œåå°ç›‘è§†æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°è§£æä¸åº”ç”¨è§„åˆ™ã€‚
- å½“æ£€æµ‹åˆ° `servers` å¢åˆ æ”¹æ—¶ï¼Œè‡ªåŠ¨å¯åŠ¨ã€åœæ­¢æˆ–é‡å¯å¯¹åº”ç›‘å¬æœåŠ¡ã€‚
- é‡è½½æˆåŠŸåè¾“å‡ºå½“å‰ç”Ÿæ•ˆçš„è§„åˆ™æ‘˜è¦ï¼Œä¾¿äºå¿«é€Ÿæ ¸éªŒã€‚
- å‚è€ƒå®ç°ï¼š[ConfigWatcher](watcher.go:33)ã€[Config.Reload()](config.go:680)ã€[processConfig()](config.go:576)ã€‚

## é…ç½®éªŒè¯ä¸é”™è¯¯å¤„ç†

é…ç½®åŠ è½½æ—¶ä¼šè¿›è¡Œä¸¥æ ¼çš„éªŒè¯ï¼Œæ— æ•ˆçš„è§„åˆ™ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤å¹¶è®°å½•è­¦å‘Šæ—¥å¿—ï¼š

- **æ˜ å°„è§„åˆ™éªŒè¯**ï¼š
  - `from` å’Œ `to` å­—æ®µå¿…é¡»å­˜åœ¨ä¸”åŒ…å«æœ‰æ•ˆçš„ URL
  - å¼•ç”¨çš„æœåŠ¡å™¨åç§°å¿…é¡»åœ¨ `servers` é…ç½®ä¸­å­˜åœ¨
  - å¼•ç”¨çš„ä»£ç†ã€éš§é“åç§°å¿…é¡»å·²å®šä¹‰
- **ç«¯ç‚¹é…ç½®éªŒè¯**ï¼š
  - URL æ ¼å¼éªŒè¯
  - æ–¹æ³•åŒ¹é…éªŒè¯
  - å¤´ä¿¡æ¯å’ŒæŸ¥è¯¢å‚æ•°æ ¼å¼éªŒè¯
- **ç­–ç•¥éªŒè¯**ï¼š
  - é€Ÿç‡é™åˆ¶å•ä½éªŒè¯ï¼ˆæ”¯æŒ kbpsã€mbpsã€gbpsï¼‰
  - æµé‡é…é¢å•ä½éªŒè¯
  - è´¨é‡ç³»æ•°èŒƒå›´éªŒè¯ï¼ˆ0.0-1.0ï¼‰

éªŒè¯å¤±è´¥çš„è§„åˆ™ä¼šè¢«è·³è¿‡ï¼ŒæœåŠ¡ä¼šç»§ç»­ä½¿ç”¨æœ‰æ•ˆçš„é…ç½®è¿è¡Œã€‚è¯¦ç»†çš„éªŒè¯é”™è¯¯ä¼šè¾“å‡ºåˆ°æ—¥å¿—ä¸­ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚

## é™„å½•ï¼šç­–ç•¥ä¸å•ä½è¯´æ˜

- è¿æ¥ç­–ç•¥å†³ç­–ï¼ˆæœ€å°å€¼ç”Ÿæ•ˆï¼‰ï¼š
  - å‚è€ƒ [ResolvePolicies()](config.go:733)ã€‚
- æµé‡ç­–ç•¥èšåˆï¼š
  - é€Ÿç‡é™åˆ¶å–æœ€å°å€¼ï¼Œé…é¢æŒ‰å±‚çº§èšåˆï¼›å‚è€ƒ [ResolveTrafficPolicies()](config.go:796)ã€[minRate()](config.go:909)ã€‚
- é€Ÿç‡å•ä½ï¼š
  - æ”¯æŒ `kbps`ã€`mbps`ã€`gbps`ï¼Œç¤ºä¾‹ `500kbps`ã€`2mbps`ï¼›å‚è€ƒ [parseRateLimit()](config.go:880)ã€‚
- æµé‡é…é¢å•ä½ï¼š
  - æ”¯æŒ `kb`ã€`mb`ã€`gb` æˆ–å­—èŠ‚æ•°å­—ï¼›å‚è€ƒ [parseSize()](traffic_shaper.go:200)ã€‚
- è¯·æ±‚æ¬¡æ•°é…é¢ï¼š
  - è®¾ç½®ä¸ºæ•´æ•°ï¼ˆæ€»è¯·æ±‚æ•°ï¼‰ã€‚
- é…é¢ç”¨é‡æŒä¹…åŒ–ï¼š
  - è¿è¡Œæ—¶é…é¢ç”¨é‡ä¼šå†™å…¥æ•°æ®æ–‡ä»¶å¹¶åœ¨é‡å¯åæ¢å¤ï¼›å‚è€ƒ [LoadDataStore()](config.go:535)ã€[SaveDataStore()](config.go:561)ã€‚

## å®Œæ•´é…ç½®ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºäº†å¤šç§åŠŸèƒ½çš„ç»¼åˆé…ç½®æ–‡ä»¶ï¼š

```json
{
  "servers": {
    "main-gateway": {
      "port": 443,
      "cert": {
        "cert": "./certs/server.crt",
        "key": "./certs/server.key"
      },
      "auth": {
        "groups": ["internal_users"]
      },
      "dump": "./logs/all_traffic.har"
    }
  },
  "auth": {
    "users": {
      "api_user": {
        "password": "secure_password",
        "groups": ["internal_users"],
        "trafficQuota": "100gb"
      }
    },
    "groups": {
      "internal_users": {}
    }
  },
  "proxies": {
    "external_proxy": {
      "urls": ["http://proxy.external.com:8080"]
    }
  },
  "scripting": {
    "pythonPath": "/usr/bin/python3"
  },
  "mappings": [
    // è§„åˆ™ 1: REST to gRPC
    {
      "from": {
        "url": "https://api.example.com/v1/users/{role}",
        "method": "POST",
        "grpc": {
          "service": "UserService",
          "method": "CreateUser",
          "rest_to_grpc": {
            "request_body_mapping": {
              "user_name": "json:name",
              "email_address": "json:email",
              "role": "path:role"
            }
          }
        }
      },
      "to": "http://grpc-user-service:50051",
      "servers": ["main-gateway"]
    },
    // è§„åˆ™ 2: è„šæœ¬åŒ–ä¿®æ”¹ + ä¸Šæ¸¸ä»£ç†
    {
      "from": {
        "url": "https://api.thirdparty.com/*",
        "script": "./scripts/add_api_key.py"
      },
      "to": "https://api.thirdparty.com/*",
      "via": {
        "proxies": "external_proxy",
        "endpoints": ["app-instance-1", "app-instance-2"]
      }
      "servers": ["main-gateway"]
    },
    // è§„åˆ™ 3: API æ¨¡æ‹Ÿ
    {
      "from": "https://api.example.com/v1/status",
      "to": "file://./mocks/status.json",
      "servers": ["main-gateway"]
    },
    // è§„åˆ™ 4: æµé‡æ•´å½¢
    {
      "from": "https://*.slow-service.com/*",
      "to": "https://backend.slow-service.com/*",
      "rateLimit": "512kbps",
      "quality": 0.9,
      "servers": ["main-gateway"]
    }
  ]
}
## ç®¡ç†é¢æ¿ä½¿ç”¨æŒ‡å—

- å…¥å£åœ°å€
  - ç®¡ç†é¢æ¿é™æ€é¡µé¢ï¼š`/.admin/`ï¼ˆCarbon Design é£æ ¼ï¼Œæ— éœ€æ„å»ºå³å¯ä½¿ç”¨ï¼‰
  - è¯ä¹¦å®‰è£…é¡µé¢ï¼š`/.ssl`ï¼ˆä¸‹è½½æ ¹ CAï¼š`Any_Proxy_Service.crt`ï¼‰
- ç™»å½•ä¸è®¤è¯
  - ç™»å½•æ¥å£ï¼š`POST /.api/login`ï¼ˆä»… `auth.users` ä¸­è®¾ç½®äº† `admin: true` çš„ç”¨æˆ·å¯ç™»å½•ï¼‰
  - ç™»å½•æˆåŠŸåï¼š
    - åç«¯ä¼šè®¾ç½® HttpOnly Cookieï¼š`APS-Admin-Token`ï¼ˆé»˜è®¤ 24h è¿‡æœŸï¼‰
    - åŒæ—¶è¿”å›ä¸€ä¸ª `token`ï¼ˆå¯é€‰ç”¨äº `Authorization: Bearer <token>`ï¼‰
  - é€€å‡ºç™»å½•ï¼š`POST /.api/logout`ï¼ˆæ¸…ç†ä¼šè¯ä¸ Cookieï¼‰
  - ç®¡ç†å‘˜ä»¤ç‰Œçš„ä¸¤ç§å½¢å¼ï¼š
    - ä¼šè¯ Cookieï¼š`APS-Admin-Token`ï¼ˆé€šè¿‡ç™»å½•è·å–ï¼‰
    - Bearer Tokenï¼š`Authorization: Bearer <token>`ï¼ˆæ¥è‡ª `config.json -> auth.users[].token`ï¼Œä¸”è¯¥ç”¨æˆ·éœ€ `admin: true`ï¼‰
- é…ç½®ç¼–è¾‘å™¨ï¼ˆéœ€ç®¡ç†å‘˜ä»¤ç‰Œï¼‰
  - è¯»å–é…ç½®ï¼š`GET /.api/config`
  - å†™å…¥é…ç½®ï¼š`POST /.api/config`ï¼ˆä¿å­˜åè§¦å‘çƒ­é‡è½½ï¼‰
  - å»ºè®®ï¼šåœ¨ç®¡ç†é¢æ¿ä¸­ç™»å½•åå³å¯ä½¿ç”¨ Cookie è®¿é—®ï¼›å¦‚éœ€è„šæœ¬è®¿é—®å¯ä½¿ç”¨ Bearer Token
- ç»Ÿè®¡ä»ªè¡¨ç›˜
  - æ•°æ®æºï¼š`GET /.api/stats`
  - åˆ·æ–°é¢‘ç‡ï¼šé»˜è®¤æ¯ 1s è‡ªåŠ¨åˆ·æ–°ï¼Œæ”¯æŒâ€œç«‹å³åˆ·æ–°â€â€œæš‚åœ/æ¢å¤â€
  - æœªè®¤è¯è®¿é—®æ—¶ï¼š`rules`/`users`/`servers`/`tunnels`/`proxies` çš„é”®åä¼šè¢«è„±æ•ï¼ˆ`md5(key + timestamp)`ï¼‰ï¼›è®¤è¯åæ˜¾ç¤ºçœŸå®åç§°
  - æŒ‡æ ‡åŒ…å«ï¼šè¯·æ±‚æ•°ã€é”™è¯¯æ•°ã€QPSã€è¯·æ±‚åŒ…/å“åº”åŒ…å¤§å°çš„å¹³å‡/æœ€å°/æœ€å¤§ã€å“åº”æ—¶é•¿çš„å¹³å‡/æœ€çŸ­/æœ€é•¿
- å¿«é€Ÿå¯¼èˆª
  - åœ¨ `/.ssl` é¡µé¢é¡¶éƒ¨å¯¼èˆªå¯ç›´æ¥è¿›å…¥ `/.admin/` ä¸æŸ¥çœ‹ `/.api/stats` åŸå§‹ JSON

## ç»Ÿè®¡æŒ‡æ ‡è¯´æ˜ï¼ˆ/.api/statsï¼‰

- é¡¶å±‚å­—æ®µ
  - `totalRequests`ï¼šè‡ªå¯åŠ¨ä»¥æ¥çš„æ€»è¯·æ±‚æ•°
  - `activeConnections`ï¼šå½“å‰æ´»è·ƒè¿æ¥æ•°
  - `totalBytesSent` / `totalBytesRecv`ï¼šè‡ªå¯åŠ¨ä»¥æ¥çš„æ€»å‘é€/æ¥æ”¶å­—èŠ‚æ•°
  - `uptime`ï¼šè¿è¡Œæ—¶é•¿
- ç»´åº¦æ˜ å°„
  - `rules` / `users` / `servers` / `tunnels` / `proxies`ï¼šé”®åä¸ºç»´åº¦çš„æ ‡è¯†ï¼ˆæœªè®¤è¯è®¿é—®æ—¶ä¸ºè„±æ•åçš„ MD5 å€¼ï¼‰
- æ¯ä¸ªç»´åº¦é¡¹çš„ç»“æ„ï¼ˆPublicMetricsï¼‰
  - `requestCount`ï¼šè¯·æ±‚æ•°
  - `errors`ï¼šé”™è¯¯æ•°
  - `qps`ï¼šæ¯ç§’è¯·æ±‚æ•°ï¼ˆåŸºäºè¯¥ç»´åº¦é¦–/æœ«æ¬¡è¯·æ±‚æ—¶é—´çª—å£è®¡ç®—ï¼›çª—å£ < 1s æ—¶é€€åŒ–ä¸º `requestCount`ï¼‰
  - `bytesSent`ï¼š
    - `total`ï¼šç´¯è®¡å‘é€å­—èŠ‚
    - `avg`ï¼šå¹³å‡æ¯è¯·æ±‚å‘é€å­—èŠ‚ï¼ˆ`total / requestCount`ï¼‰
    - `min` / `max`ï¼šå•è¯·æ±‚å‘é€å­—èŠ‚çš„æœ€å°/æœ€å¤§å€¼
  - `bytesRecv`ï¼š
    - åŒ `bytesSent` å­—æ®µè¯´æ˜
  - `responseTime`ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ï¼š
    - `totalMs`ï¼šç´¯è®¡å“åº”æ—¶é•¿ï¼ˆns æ±‡æ€»åè½¬ msï¼‰
    - `avgMs`ï¼šå¹³å‡å“åº”æ—¶é•¿ï¼ˆ`total / requestCount` åè½¬ msï¼‰
    - `minMs` / `maxMs`ï¼šå•è¯·æ±‚å“åº”æ—¶é•¿çš„æœ€çŸ­/æœ€é•¿å€¼ï¼ˆmsï¼‰
- ç¤ºä¾‹ï¼ˆéƒ¨åˆ†å­—æ®µï¼‰ï¼š
  ```json
  {
    "totalRequests": 12345,
    "activeConnections": 7,
    "rules": {
      "rule-key-or-masked": {
        "requestCount": 100,
        "errors": 2,
        "qps": 5.5,
        "bytesSent": { "total": 1024000, "avg": 10240.0, "min": 512, "max": 65536 },
        "bytesRecv": { "total": 2048000, "avg": 20480.0, "min": 1024, "max": 131072 },
        "responseTime": { "totalMs": 2500.0, "avgMs": 25.0, "minMs": 3, "maxMs": 120 }
      }
    }
  }
```

- è®¡ç®—ä¸åˆå§‹å€¼çº¦å®š
  - æœ€å°å€¼åˆå§‹å“¨å…µï¼š
    - `bytesSent.min` / `bytesRecv.min` åˆå§‹ä¸º `^uint64(0)`ï¼Œè‹¥æ— æ•°æ®åˆ™åœ¨è¾“å‡ºæ—¶å½’é›¶
    - `responseTime.min` åˆå§‹ä¸º `-1`ï¼Œè‹¥æ— æ•°æ®åˆ™åœ¨è¾“å‡ºæ—¶å½’é›¶
  - QPS çª—å£ï¼š
    - ä½¿ç”¨è¯¥ç»´åº¦çš„é¦–ä¸ªè¯·æ±‚æ—¶é—´ä¸æœ€æ–°è¯·æ±‚æ—¶é—´çš„åŒºé—´ï¼›åŒºé—´ç§’æ•° â‰¤ 1 æ—¶ï¼Œ`qps = requestCount`
